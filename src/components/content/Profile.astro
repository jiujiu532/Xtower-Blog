---
import { Icon } from "astro-icon/components";
import { profileConfig } from "@/config/profileConfig";
import { url } from "@/utils/url-utils";
import ImageWrapper from "@/components/misc/ImageWrapper.astro";
---

<div class="card-base p-3">
  <a
    aria-label="Go to About Page"
    href={url("/about/")}
    class="group block relative mx-auto mt-1 lg:mx-0 lg:mt-0 mb-3
       max-w-[12rem] lg:max-w-none overflow-hidden rounded-xl active:scale-95"
  >
    <div
      class="absolute transition pointer-events-none group-hover:bg-black/30 group-active:bg-black/50
        w-full h-full z-50 flex items-center justify-center"
    >
      <Icon
        name="fa6-regular:address-card"
        class="transition opacity-0 scale-90 group-hover:scale-100 group-hover:opacity-100 text-white text-5xl"
      />
    </div>
    <ImageWrapper
      src={profileConfig.avatar || ""}
      alt="Profile Image of the Author"
      class="mx-auto lg:w-full h-full lg:mt-0"
    />
  </a>
  <div class="px-2">
    <div
      class="font-bold text-xl text-center mb-1 dark:text-neutral-50 transition"
    >
      {profileConfig.name}
    </div>
    <div
      class="h-1 w-5 bg-[var(--primary)] mx-auto rounded-full mb-2 transition"
    >
    </div>
    <div class="text-center text-neutral-400 mb-2.5 transition profile-bio-container">
      <span class="profile-bio-text" data-bio={profileConfig.bio}></span><span class="profile-bio-cursor">|</span>
    </div>
    <div class="flex gap-2 justify-center mb-1">
      {
        profileConfig.links.length > 1 &&
          profileConfig.links.map((item) => (
            <a
              rel="me"
              aria-label={item.name}
              href={item.url}
              target="_blank"
              class="btn-regular rounded-lg h-10 w-10 active:scale-90"
            >
              <Icon name={item.icon} class="text-[1.5rem]" />
            </a>
          ))
      }
      {
        profileConfig.links.length == 1 && (
          <a
            rel="me"
            aria-label={profileConfig.links[0].name}
            href={profileConfig.links[0].url}
            target="_blank"
            class="btn-regular rounded-lg h-10 gap-2 px-3 font-bold active:scale-95"
          >
            <Icon name={profileConfig.links[0].icon} class="text-[1.5rem]" />
            {profileConfig.links[0].name}
          </a>
        )
      }
    </div>
  </div>
</div>



<style>
  .profile-bio-cursor {
    animation: profile-blink 1s infinite;
    margin-left: 1px;
  }
  
  @keyframes profile-blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }
</style>

<script>
  // 使用全局标记防止重复执行
  function runProfileTypewriter() {
    const bioElement = document.querySelector('.profile-bio-text');
    if (!bioElement) return;
    
    const bioText = bioElement.getAttribute('data-bio') || '';
    
    // 检查是否已经打完（通过检查当前文本长度）
    if (bioElement.textContent === bioText) {
      return; // 已经打完，不再执行
    }
    
    // 检查是否正在打字（通过检查是否有部分文本）
    if (bioElement.textContent && bioElement.textContent.length > 0 && bioElement.textContent.length < bioText.length) {
      return; // 正在打字中，不重复执行
    }
    
    // 清空并开始打字
    bioElement.textContent = '';
    let index = 0;
    const speed = 150; // 打字速度（毫秒），比之前慢一点
    
    function type() {
      if (index < bioText.length) {
        bioElement.textContent = bioText.substring(0, index + 1);
        index++;
        setTimeout(type, speed);
      }
    }
    
    // 延迟300ms后开始打字
    setTimeout(type, 300);
  }
  
  // 页面加载完成后执行
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', runProfileTypewriter);
  } else {
    runProfileTypewriter();
  }
</script>
